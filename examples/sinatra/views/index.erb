<!doctype html>
<html lang="en">
  <head>
    <title>Rack::Stream Chat Example</title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  </head>
  <body>
    <ul class="messages">

    </ul>
    <form id="chat_input">
      <input type='text' name='text' />
    </form>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type='text/javascript'>
      var socket;

      function message(m) {
        $('<li>').text(m).appendTo('.messages');
      }

      socket = new WebSocket("ws://localhost:3000/messages");
      socket.onopen    = function()  {message('Connection opened');}
      socket.onclose   = function()  {message('Connection closed');}
      socket.onmessage = function(m) {
        m = JSON.parse(m.data);
        m = m.stream_transport + ": " + m.text
        message(m);
      }
    </script>
  </body>
</html>